@using Microsoft.AspNetCore.Components.Forms
@namespace Daemon.RazorUI.Input
@inject ILogger<DmnComboBox> Logger
@inherits InputText


<label 
    class=@($@"
        dmn-input-label
        relative
        {Class}
    ")
>
    @Label
    <input 
        class="dmn-input-text" 
        @bind="CurrentValueAsString" 
        @bind:event="oninput" 
        @attributes="AdditionalAttributes" 
        @onfocus="HandleFocus"
        @onblur="HandleBlur"
        aria-controls="options" 
        aria-expanded="false"
    />
    <ValidationMessage For=@ValueExpression />
    
    @if(_isActive) {
            <ul class="absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm" id="options" role="listbox">
                <!--
                    Combobox option, manage highlight styles based on mouseenter/mouseleave and keyboard navigation.

                    Active: "text-white bg-indigo-600", Not Active: "text-gray-900"
                -->
                @foreach(var option in Options)
                {
                    <li 
                        class="
                            relative 
                            cursor-default select-none 
                            py-2 pl-3 pr-9 
                            text-gray-900
                            group
                            hover:bg-sky-500 hover:text-white
                        " 
                        id="option-0" 
                        role="option" 
                        tabindex="-1"
                        @onclick=@(e => OnOptionClick(option.Value))
                    >
                        <!-- Selected: "font-semibold" -->
                        <span class="block truncate">@option.Label</span>

                        <!--
                        Checkmark, only display for selected option.

                        Active: "text-white", Not Active: "text-indigo-600"
                        -->
                        <span class="absolute inset-y-0 right-0 flex items-center pr-4 text-sky-500">
                            <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z" clip-rule="evenodd" />
                            </svg>
                        </span>
                    </li>
                }
            </ul>
        }
</label>

@code {
       
    [Parameter]
    public string Label { get; set; }

    [Parameter]
    public string Class { get; set; }

    [Parameter]
    public IQueryable<DmnSelectOption> Options { get; set; }

    private bool _isActive = false;


    private void HandleFocus(FocusEventArgs e)
    {
        Logger.LogInformation("Focus");
        _isActive = true;
    }

    private void HandleBlur(FocusEventArgs e)
    {
        Logger.LogInformation("Blur");
        _isActive = false;
    }

    private void OnOptionClick(string locationLinkId)
    {
        Logger.LogInformation($"Option Clicked: {locationLinkId}");
    }
}